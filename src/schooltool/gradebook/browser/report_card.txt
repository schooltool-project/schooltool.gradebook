============
Report Cards
============

The end goal of having users enter grades is for parents to receive a
report card from the school after each grading period has ended.  To facilitate
this, the admin user will set up report sheet templates at the application
level, then choose on to deploy to a given term.  This deployment will
result in a special worksheet being inserted into every section for that
term so that the teachers can enter the final grades of the grading period.
Finally, the admin user will be able to request report cards to be printed
after each gradding period has ended.

Let's start by setting up the application and logging in as manager.

    >>> from schooltool.app.browser.ftests import setup
    >>> setup.setUpBasicSchool()
    >>> manager = Browser('manager', 'schooltool')

The first step is to set up the report sheet templates.  This is done from
the Manage tab.

    >>> manager.getLink('Manage').click()
    >>> manager.getLink('Report Sheet Templates').click()

We see that there are no report worksheets yet.

    >>> analyze.printQuery("id('content-body')//a", manager.contents)

We'll add one.

    >>> manager.getLink('New Report Worksheet').click()
    >>> manager.getControl('Title').value = 'Test'
    >>> manager.getControl('Add').click()

Now we see that the new report worksheet appears in the list.

    >>> analyze.printQuery("id('content-body')//a", manager.contents)
    <a href="http://localhost/schooltool.gradebook/templates/ReportWorksheet">Test</a>

We'll click on it to view its activities.  We see that there are none.

    >>> manager.getLink('Test').click()
    >>> analyze.printQuery("id('content-body')//a", manager.contents)

To add a report activity to it, we'll click on the supplied link.  We need only
fill in the title as the other required fields default to the first value
in the vocabulary.

    >>> manager.getLink('New Report Activity').click()
    >>> manager.getControl('Title').value = 'Activity 1'
    >>> manager.getControl('Add').click()

Now we see that the new report activity appears in the list.

    >>> analyze.printQuery("id('content-body')//a", manager.contents)
    <a href="http://localhost/schooltool.gradebook/templates/ReportWorksheet/ReportActivity">Activity 1</a>

Next, we'll click on the newly added activity link to edit its score system.
We see that, when it was added, it was defaulted to the first existing score
system in the list.

    >>> manager.getLink('Activity 1').click()
    >>> manager.getControl('Exisiting Score System').value
    ['100 Points']

We'll change it, apply the change, and revisit the activity to see that the
change took.

    >>> manager.getControl('Exisiting Score System').value = ['Letter Grade']
    >>> manager.getControl('Apply').click()
    >>> manager.getLink('Activity 1').click()
    >>> manager.getControl('Exisiting Score System').value
    ['Letter Grade']

Later we will want to test the handling of deployment of multiple templates
to a term, so here we'll set up a second template.

    >>> manager.getLink('Manage').click()
    >>> manager.getLink('Report Sheet Templates').click()
    >>> manager.getLink('New Report Worksheet').click()
    >>> manager.getControl('Title').value = 'Test2'
    >>> manager.getControl('Add').click()
    >>> manager.getLink('Test2').click()
    >>> manager.getLink('New Report Activity').click()
    >>> manager.getControl('Title').value = 'Activity 2'
    >>> manager.getControl('Add').click()

Report Worksheet Deployment
---------------------------

Now that we've set up report sheet templates, we want to choose one of them
to deploy to all sections in a given term.  We'll need to set up one of our
terms with some sections.  Of course, we'll need a teacher and some students
in order to do that.

    >>> setup.addPerson('Teacher One', 'teacher1', 'pwd')
    >>> setup.addPerson('Student One', 'student1', 'pwd')
    >>> setup.addPerson('Student Two', 'student2', 'pwd')
    >>> setup.addCourse('CompSci I', '2005-2006')
    >>> setup.addSection('CompSci I', '2005-2006', 'Spring',
    ...                  title='Morning CompSci I',
    ...                  instructors=['Teacher One'],
    ...                  members=['Student One','Student Two'])
    >>> setup.addSection('CompSci I', '2005-2006', 'Spring',
    ...                  title='Afternoon CompSci I',
    ...                  instructors=['Teacher One'],
    ...                  members=['Student One','Student Two'])

We'll navigate to the 'Spring' term where we just created the two sections,
and we'll click on the 'Deploy Report Worksheet' link.

    >>> manager.getLink('2005-2006').click()
    >>> manager.getLink('Spring').click()
    >>> term_url = manager.url
    >>> manager.getLink('Deploy Report Worksheet').click()

Hitting the 'Cancel' button brings us back to the term view.

    >>> manager.getControl('Cancel').click()
    >>> manager.url == term_url
    True

Now we'll go back to the view and this time hit the 'Deploy' button.  This will
also bring us back to the term view.  First we'll deploy the first template,
then the second.

    >>> manager.getLink('Deploy Report Worksheet').click()
    >>> manager.getControl('Template').value = ['ReportWorksheet']
    >>> manager.getControl('Deploy').click()
    >>> manager.url == term_url
    True
    >>> manager.getLink('Deploy Report Worksheet').click()
    >>> manager.getControl('Template').value = ['ReportWorksheet-2']
    >>> manager.getControl('Deploy').click()

To make sure the deployment worked, we'll navigate to each section and make sure
the worksheets and activities are there.  We'll start with the first section.
In addition to testing for the presence of the worksheets and activities, we'll
make sure that there is no checkbox available to delete any of them.

    >>> manager.getLink('Sections').click()
    >>> manager.getLink('Morning CompSci I').click()
    >>> manager.getLink('Gradebook', index=1).click()
    >>> manager.getLink('Worksheets').click()

    >>> analyze.printQuery("id('content-body')//a", manager.contents)
    <a href="http://localhost/schoolyears/2005-2006/spring/sections/1/activities/Worksheet/manage.html">Test</a>
    <a href="http://localhost/schoolyears/2005-2006/spring/sections/1/activities/Worksheet-2/manage.html">Test2</a>

    >>> 'checkbox' not in analyze.queryHTML("id('content-body')", manager.contents)[0]
    True

    >>> manager.getLink('Test').click()
    >>> analyze.printQuery("id('content-body')//a", manager.contents)
    <a href="http://localhost/schoolyears/2005-2006/spring/sections/1/activities/Worksheet/Activity">Activity 1</a>

    >>> 'checkbox' not in analyze.queryHTML("id('content-body')", manager.contents)[0]
    True

    >>> manager.open(term_url)
    >>> manager.getLink('Sections').click()
    >>> manager.getLink('Morning CompSci I').click()
    >>> manager.getLink('Gradebook', index=1).click()
    >>> manager.getLink('Worksheets').click()
    >>> manager.getLink('Test2').click()
    >>> analyze.printQuery("id('content-body')//a", manager.contents)
    <a href="http://localhost/schoolyears/2005-2006/spring/sections/1/activities/Worksheet-2/Activity">Activity 2</a>

    >>> 'checkbox' not in analyze.queryHTML("id('content-body')", manager.contents)[0]
    True

The other section should also have the same worksheet deployed.

    >>> manager.open(term_url)
    >>> manager.getLink('Sections').click()
    >>> manager.getLink('Afternoon CompSci I').click()
    >>> manager.getLink('Gradebook', index=1).click()
    >>> manager.getLink('Worksheets').click()

    >>> analyze.printQuery("id('content-body')//a", manager.contents)
    <a href="http://localhost/schoolyears/2005-2006/spring/sections/2/activities/Worksheet/manage.html">Test</a>
    <a href="http://localhost/schoolyears/2005-2006/spring/sections/2/activities/Worksheet-2/manage.html">Test2</a>

    >>> 'checkbox' not in analyze.queryHTML("id('content-body')", manager.contents)[0]
    True

    >>> manager.getLink('Test').click()
    >>> analyze.printQuery("id('content-body')//a", manager.contents)
    <a href="http://localhost/schoolyears/2005-2006/spring/sections/2/activities/Worksheet/Activity">Activity 1</a>

    >>> 'checkbox' not in analyze.queryHTML("id('content-body')", manager.contents)[0]
    True

    >>> manager.open(term_url)
    >>> manager.getLink('Sections').click()
    >>> manager.getLink('Afternoon CompSci I').click()
    >>> manager.getLink('Gradebook', index=1).click()
    >>> manager.getLink('Worksheets').click()
    >>> manager.getLink('Test2').click()
    >>> analyze.printQuery("id('content-body')//a", manager.contents)
    <a href="http://localhost/schoolyears/2005-2006/spring/sections/2/activities/Worksheet-2/Activity">Activity 2</a>

    >>> 'checkbox' not in analyze.queryHTML("id('content-body')", manager.contents)[0]
    True

