<tal:tag condition="view/update" />
<html metal:use-macro="context/@@standard_macros/page"
      i18n:domain="schooltool.gradebook">
<head>
  <title metal:fill-slot="title" i18n:translate="">
    Gradebook
  </title>
  <metal:block fill-slot="extrahead">
    <script type="text/javascript" src="gradebook_overview.js">
    </script>
  </metal:block>
</head>
<body>
<div metal:fill-slot="body">

    <h1 style="color: red" id="javascript-warning">
    Your browser either has Javascript turned off, or it is not supported.
    Javascript is <b>required</b> for the gradebook.
    Please enable Javascript or use a browser with Javascript.
    </h1>
    <script type="text/javascript">
      <!--
	  document.getElementById("javascript-warning").innerHTML = "";
	  //-->
    </script>
    <form method="post"
          tal:attributes="action string:${context/@@absolute_url}">

    <tal:if condition="python:not list(view.getSections())">
      <b>Term:</b>
      <span tal:content="view/getCurrentTerm" />
    </tal:if>
    <tal:if condition="python:list(view.getTerms())">
      <label for="currentTerm" i18n:translate="">Term</label>
      <select name="currentTerm"
              onchange="this.form.submit()">
        <tal:block repeat="term python:view.getTerms()">
          <option value="1"
              tal:condition="python:term['title'] != view.getCurrentTerm()"
              tal:attributes="value term/title"
              tal:content="term/title" />
          <option value="1" selected="selected"
              tal:condition="python:term['title'] == view.getCurrentTerm()"
              tal:attributes="value term/title"
              tal:content="term/title" />
        </tal:block>
      </select>
    </tal:if>

    <span>&nbsp;&nbsp;&nbsp;&nbsp;</span>
    <tal:if condition="python:not list(view.getSections())">
      <b>Section:</b>
      <span tal:content="view/getCurrentSection" />
    </tal:if>
    <tal:if condition="python:list(view.getSections())">
      <label for="currentSection" i18n:translate="">Section</label>
      <select name="currentSection"
              onchange="this.form.submit()">
        <tal:block repeat="section python:view.getSections()">
          <option value="1"
              tal:condition="python:section['title'] != view.getCurrentSection()"
              tal:attributes="value section/title"
              tal:content="section/title" />
          <option value="1" selected="selected"
              tal:condition="python:section['title'] == view.getCurrentSection()"
              tal:attributes="value section/title"
              tal:content="section/title" />
        </tal:block>
      </select>
    </tal:if>

    <span>&nbsp;&nbsp;&nbsp;&nbsp;</span>
    <input type="checkbox" checked name="due_date" 
           tal:condition="view/getDueDateFilter" />
    <input type="checkbox" name="due_date:list" 
           tal:condition="not: view/getDueDateFilter" />
    <span>show only activities due in past</span>
    <select name="num_weeks">
      <tal:block repeat="weeks view/weeksChoices">
        <option value="1"
            tal:condition="python:weeks != view.getCurrentWeeks()"
            tal:attributes="value weeks"
            tal:content="weeks" />
        <option value="1" selected="selected"
            tal:condition="python:weeks == view.getCurrentWeeks()"
            tal:attributes="value weeks"
            tal:content="weeks" />
      </tal:block>
    </select>
    <span>weeks</span>
    <br /><br />

  <div class="message" style="color:red"
       tal:condition="view/message"
       tal:content="view/message">
    Message
  </div>
  <br />

  <table class="schooltool_gradebook">
    <tr>
      <tal:block repeat="worksheet view/worksheets">
        <td class="active_tab">
          <a tal:condition="not: worksheet/current"
             tal:attributes="href worksheet/url"
             tal:content="worksheet/title" />
          <span style="font-weight: bold;"
                tal:condition="worksheet/current"
                tal:content="worksheet/title" />
        </td>
      </tal:block>
    <tr>
  </table>

  <table class="schooltool_gradebook">
    <tr tal:condition="python:len(view.descriptions) > 0">
      <td id="description" class="gradebook_description"
          tal:attributes="colspan python:len(view.descriptions) + view.apply_all_colspan" />
    </tr>

    <tr>
     <th class="cell header">
       <div i18n:translate="">Name</div>
       <a href="?sort_by=student" i18n:translate="">(sort)</a>
     </th>
     <th tal:condition="not: view/total_hide" class="cell padded header">
       <div tal:content="view/total_label" />
     </th>
     <th tal:condition="not: view/average_hide" class="cell padded header">
       <div tal:content="view/average_label" />
       <a tal:condition="nothing" href="?sort_by=average" i18n:translate="">(sort)</a>
     </th>
     <th class="cell title header" tal:repeat="activity view/activities"
         tal:attributes="onmouseover string:tempDescription('${activity/hash}');
                         onmouseout string:restoreDescription()">
       <div class="padded">
         <a href=""
            tal:attributes="href 
                            string:gradeActivity.html?activity=${activity/hash};
                            title activity/longTitle;"
            tal:content="activity/shortTitle">
           HW 1
         </a>
       </div>
       <a href="?sort_by="
          tal:attributes="href
              string:${request/URL}?sort_by=${activity/hash}"
          i18n:translate="">
         (sort)
       </a>
       <div tal:content="activity/max" />
     </th>
    </tr>

    <tr>
      <td tal:attributes="colspan view/apply_all_colspan"
          class="cell padded fd_cell empty" i18n:translate="">Apply a grade for all students:</td>
      <td class="cell padded fd_cell" tal:repeat="activity view/activities"
          tal:attributes="id string:fd_${activity/hash}_cell">
        <input type="text" size="4" class="data fd"
               onkeydown="spreadsheetBehaviour(event)"
               tal:attributes="id string:fd_${activity/hash};
                               onkeyup string:checkFillDown('${activity/hash}');
                               onfocus string:handleCellFocus(this, '${activity/hash}')">
        <input type="button"
               style="display: none"
               class="fdbtn"
               value="Apply"
               tal:attributes="id string:fdbtn_${activity/hash};
                               onclick string:performFillDown('${activity/hash}')">
      </td>
    </tr>

    <tr tal:repeat="row view/table">
      <tal:if condition="repeat/row/even">
        <td class="cell padded even">
          <a href=""
             tal:attributes="href row/student/url"
             tal:content="row/student/title">
            Tom Hoffman
          </a>
          <a href=""
             tal:attributes="href row/student/gradeurl">
            &gt;
          </a>
        </td>
        <td tal:condition="not: view/total_hide" class="cell padded even">
	      <tal:if condition="row/total|nothing">
	        <b><span tal:replace="row/total" /></b>
	      </tal:if>
        </td>
        <td tal:condition="not: view/average_hide" class="cell padded even">
	      <tal:if condition="row/average|nothing">
	        <b><span tal:replace="row/average" /></b>
	      </tal:if>
        </td>
        <td class="cell even" tal:repeat="grade row/grades"
            tal:attributes="id string:${grade/activity}_${row/student/id}_cell">
          <b tal:condition="not: grade/editable"
             tal:content="grade/value" />
          <input class="data" type="text" name="" value="" size="4"
                 tal:condition="grade/editable"
                 onkeydown="spreadsheetBehaviour(event)"
                 tal:attributes="name string:${grade/activity}_${row/student/id};
                                 id string:${grade/activity}_${row/student/id};
                                 value grade/value;
                                 onkeyup string:checkValid(event,'${grade/activity}_${row/student/id}');
                                 onfocus string:handleCellFocus(this, '${grade/activity}')"/>
        </td>
      </tal:if>
      <tal:if condition="repeat/row/odd">
        <td class="cell padded odd">
          <a href=""
             tal:attributes="href row/student/url"
             tal:content="row/student/title">
            Tom Hoffman
          </a>
          <a href=""
             tal:attributes="href row/student/gradeurl">
            &gt;
          </a>
        </td>
        <td tal:condition="not: view/total_hide" class="cell padded odd">
	      <tal:if condition="row/total|nothing">
	        <b><span tal:replace="row/total" /></b>
	      </tal:if>
        </td>
        <td tal:condition="not: view/average_hide" class="cell padded odd">
	      <tal:if condition="row/average|nothing">
	        <b><span tal:replace="row/average" /></b>
	      </tal:if>
        </td>
        <td class="cell odd" tal:repeat="grade row/grades"
            tal:attributes="id string:${grade/activity}_${row/student/id}_cell">
          <b tal:condition="not: grade/editable"
             tal:content="grade/value" />
          <input class="data" type="text" name="" value="" size="4"
                 tal:condition="grade/editable"
                 onkeydown="spreadsheetBehaviour(event)"
                 tal:attributes="name string:${grade/activity}_${row/student/id};
                                 id string:${grade/activity}_${row/student/id};
                                 value grade/value;
                                 onkeyup string:checkValid(event,'${grade/activity}_${row/student/id}');
                                 onfocus string:handleCellFocus(this, '${grade/activity}')"/>
        </td>
      </tal:if>
    </tr>
  </table>

  <div class="controls">
    <input type="submit" class="button-ok" name="UPDATE_SUBMIT" value="Save" 
           onclick="setNotEdited()"/>
  </div>

  </form>
</div>
</body>
</html>
