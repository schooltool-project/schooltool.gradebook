<div>
    <tal:block replace="resource_library:schooltool.gradebook.flourish" />
    <metal:block tal:replace="structure string:&lt;script type=&quot;text/javascript&quot;&gt;" />
      var numstudents = <tal:block replace="python: len(view.students)"/>;
      var students = new Array(numstudents);
      <tal:loop repeat="row view/table">
      students[<tal:block replace="repeat/row/index"/>] = '<tal:block replace="python: view.breakJSString(row['student']['id'])"/>';
      </tal:loop>
      var numactivities = <tal:block replace="python: len(view.scorableActivities())"/>;
      var activities = new Array(numactivities);
      <tal:loop repeat="activity view/activities">
      activities[<tal:block replace="repeat/activity/index"/>] = '<tal:block replace="activity/hash"/>';
      </tal:loop>
      var numscores = <tal:block replace="python: len(view.scores)"/>;
      var scores = new Object();
      <tal:loop repeat="activity view/scores">
      scores['<tal:block replace="activity" />'] = new Array(<tal:block replace="python: view.scores[activity]" />);
      </tal:loop>
      var numdescriptions = <tal:block replace="python: len(view.descriptions)"/>;
      var descriptions = new Array(numdescriptions);
      <tal:loop repeat="activity view/descriptions">
      descriptions['<tal:block replace="activity/act_hash"/>'] = '<tal:block replace="activity/description"/>';
      </tal:loop>
      var edited = false;
      var currentCell;
      var currentDesc = '';
      window.onload = onLoadHandler;
      window.onunload = checkChanges;
      warningText = '<tal:block replace="view/warningText" />';
    <metal:block tal:replace="structure string:&lt;/script&gt;" />
    <form method="post"
          tal:attributes="action string:${context/@@absolute_url}">

  <div class="gradebook-message"
       tal:condition="view/message"
       tal:content="view/message">
    Message
  </div>

  <table class="schooltool_gradebook">
    <tr>
     <th>
       <div i18n:translate="">Name</div>
       <a href="?sort_by=student" i18n:translate="">(sort)</a>
     </th>
     <th tal:condition="not: view/absences_hide">
       <div tal:content="view/absences_label" />
     </th>
     <th tal:condition="not: view/tardies_hide">
       <div tal:content="view/tardies_label" />
     </th>
     <th tal:condition="not: view/total_hide">
       <div tal:content="view/total_label" />
     </th>
     <th tal:condition="not: view/average_hide">
       <div tal:content="view/average_label" />
       <a tal:condition="nothing" href="?sort_by=average" i18n:translate="">(sort)</a>
     </th>
     <th class="activity" tal:repeat="activity view/activities">
       <div>
         <a href=""
            tal:condition="activity/scorable"
            tal:attributes="href 
                            string:gradeActivity.html?activity=${activity/hash};
                            title activity/longTitle;"
            tal:content="activity/shortTitle" />
         <span
            tal:condition="not: activity/scorable"
            tal:content="activity/shortTitle" />
       </div>
       <a href="?sort_by="
          tal:attributes="href
              string:${request/URL}?sort_by=${activity/hash}"
          i18n:translate="">
         (sort)
       </a>
       <div tal:content="activity/max" />
     </th>
    </tr>

    <tr tal:repeat="row view/table">
      <metal:block>
        <td>
          <a href=""
             tal:attributes="href row/student/url"
             tal:content="row/student/title">
            Tom Hoffman
          </a>
          <a href=""
             tal:attributes="href row/student/gradeurl">
            &gt;
          </a>
        </td>
        <td tal:condition="not: view/absences_hide">
	      <tal:if condition="row/absences|nothing">
	        <b><span tal:replace="row/absences" /></b>
	      </tal:if>
        </td>
        <td tal:condition="not: view/tardies_hide">
	      <tal:if condition="row/tardies|nothing">
	        <b><span tal:replace="row/tardies" /></b>
	      </tal:if>
        </td>
        <td tal:condition="not: view/total_hide">
	      <tal:if condition="row/total|nothing">
	        <b><span tal:replace="row/total" /></b>
	      </tal:if>
        </td>
        <td tal:condition="not: view/average_hide">
	      <tal:if condition="row/average|nothing">
	        <b><span tal:replace="row/average" /></b>
	      </tal:if>
        </td>
        <td class="activity"
            tal:repeat="grade row/grades"
            tal:attributes="id string:${grade/activity}_${row/student/id}_cell">
          <span tal:condition="not: grade/editable"
             tal:content="grade/value" />
          <input type="text" name="" value="" size="4"
                 tal:condition="grade/editable"
                 onkeydown="return spreadsheetBehaviour(event)"
                 tal:attributes="name string:${grade/activity}_${row/student/id};
                                 id string:${grade/activity}_${row/student/id};
                                 value grade/value;
                                 onkeyup string:checkValid(event,'${grade/activity}_${row/student/id}');
                                 onfocus string:handleCellFocus(this, '${grade/activity}')"/>
        </td>
      </metal:block>
    </tr>
  </table>

  <div class="buttons controls">
    <input type="submit" class="button-ok" name="UPDATE_SUBMIT" value="Save" 
           onclick="setNotEdited()"
           title="Shortcut: Alt-S" accesskey="S"
           i18n:attributes="value; title; accesskey" />
  </div>

  </form>
</div>

